<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Sort Visualisierung</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8dcd0 0%, #d4c8b8 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #2c3e50;
            text-decoration: none;
            font-weight: bold;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #333;
            color: white;
        }

        .btn-primary:hover {
            background: #555;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #2c3e50;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            width: 200px;
        }

        .visualization {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 40px 20px;
            min-height: 400px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            position: relative;
        }

        .bar {
            background: #333;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .bar.pivot {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .bar.comparing {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .bar.partition {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .bar.sorted {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        .bar-value {
            color: white;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .info-panel {
            background: #f8f9fa;
            color: #2c3e50;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin-bottom: 20px;
            min-height: 80px;
        }

        .info-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .info-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            min-height: 85px;
        }

        .info-item strong {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #666;
        }

        .info-value {
            font-size: 1.1em;
            color: #2c3e50;
            min-height: 2.4em;
            display: flex;
            align-items: center;
        }

        .pivot-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, #f5576c 20%, #f5576c 80%, transparent 100%);
            pointer-events: none;
            z-index: 10;
            box-shadow: 0 0 8px rgba(245, 87, 108, 0.6);
        }

        .pivot-marker {
            position: absolute;
            top: -6px;
            width: 12px;
            height: 12px;
            background: #f5576c;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(245, 87, 108, 0.8);
            border: 2px solid white;
            z-index: 11;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← Zurück zur Übersicht</a>

        <div class="header">
            <h1>Quick Sort Visualisierung</h1>
        </div>

        <div class="description">
            <strong>Funktionsweise:</strong> Quick Sort wählt ein Pivot-Element aus und teilt das Array in zwei Teile:
            Elemente kleiner als das Pivot und Elemente größer als das Pivot. Dieser Prozess wird rekursiv auf beide
            Teile angewendet. Die Effizienz des Algorithmus hängt stark von der Wahl des Pivot-Elements ab.
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="startSort()">Sortierung starten</button>
            <button class="btn-secondary" onclick="resetArray()">Neues Array</button>
            <button class="btn-secondary" onclick="pauseSort()">Pause/Fortsetzen</button>

            <div class="slider-container">
                <label>Geschwindigkeit:</label>
                <input type="range" id="speedSlider" min="10" max="500" value="100" step="10">
                <span id="speedValue">100ms</span>
            </div>

            <div class="slider-container">
                <label>Array-Größe:</label>
                <input type="range" id="sizeSlider" min="5" max="50" value="20" step="1" onchange="resetArray()">
                <span id="sizeValue">20</span>
            </div>
        </div>

        <div class="info-panel">
            <div class="info-title">Aktueller Status</div>
            <div class="info-content">
                <div class="info-item">
                    <strong>Pivot-Element:</strong>
                    <div class="info-value" id="pivotElement">-</div>
                </div>
                <div class="info-item">
                    <strong>Partition-Bereich:</strong>
                    <div class="info-value" id="partitionRange">-</div>
                </div>
                <div class="info-item">
                    <strong>Aktion:</strong>
                    <div class="info-value" id="currentAction">Warte auf Start...</div>
                </div>
                <div class="info-item">
                    <strong>Rekursionstiefe:</strong>
                    <div class="info-value" id="recursionDepth">0</div>
                </div>
            </div>
        </div>

        <div class="visualization" id="visualization"></div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="comparisons">0</div>
                <div class="stat-label">Vergleiche</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="swaps">0</div>
                <div class="stat-label">Vertauschungen</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="recursions">0</div>
                <div class="stat-label">Rekursionen</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="time">0.0s</div>
                <div class="stat-label">Zeit</div>
            </div>
        </div>
    </div>

    <script>
        let array = [];
        let comparisons = 0;
        let swaps = 0;
        let recursions = 0;
        let isSorting = false;
        let isPaused = false;
        let startTime = 0;
        let timerInterval = null;

        const visualization = document.getElementById('visualization');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const sizeSlider = document.getElementById('sizeSlider');
        const sizeValue = document.getElementById('sizeValue');

        speedSlider.addEventListener('input', (e) => {
            speedValue.textContent = e.target.value + 'ms';
        });

        sizeSlider.addEventListener('input', (e) => {
            sizeValue.textContent = e.target.value;
        });

        function generateArray(size) {
            const arr = [];
            for (let i = 0; i < size; i++) {
                arr.push(Math.floor(Math.random() * 100) + 10);
            }
            return arr;
        }

        function renderArray(highlightIndices = {}) {
            visualization.innerHTML = '';
            const maxValue = Math.max(...array);
            const barWidth = Math.max(10, Math.min(40, (visualization.offsetWidth - array.length * 4) / array.length));

            array.forEach((value, index) => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = `${(value / maxValue) * 300}px`;
                bar.style.width = `${barWidth}px`;
                bar.id = `bar-${index}`;

                if (highlightIndices.pivot === index) {
                    bar.classList.add('pivot');
                } else if (highlightIndices.comparing && highlightIndices.comparing.includes(index)) {
                    bar.classList.add('comparing');
                } else if (highlightIndices.partition &&
                          index >= highlightIndices.partition.start &&
                          index <= highlightIndices.partition.end) {
                    bar.classList.add('partition');
                } else if (highlightIndices.sorted && highlightIndices.sorted.includes(index)) {
                    bar.classList.add('sorted');
                }

                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = value;
                bar.appendChild(barValue);

                visualization.appendChild(bar);
            });

            // Horizontale Linie am Pivot-Element
            if (highlightIndices.pivot !== undefined) {
                const pivotValue = array[highlightIndices.pivot];
                const pivotHeight = (pivotValue / maxValue) * 300;

                const pivotLine = document.createElement('div');
                pivotLine.className = 'pivot-line';
                pivotLine.style.bottom = `${pivotHeight + 40}px`;
                visualization.appendChild(pivotLine);

                // Marker am Pivot-Element
                const pivotBar = document.getElementById(`bar-${highlightIndices.pivot}`);
                if (pivotBar) {
                    const pivotMarker = document.createElement('div');
                    pivotMarker.className = 'pivot-marker';
                    const barRect = pivotBar.getBoundingClientRect();
                    const visRect = visualization.getBoundingClientRect();
                    const markerLeft = barRect.left - visRect.left + (barRect.width / 2) - 6;
                    pivotMarker.style.left = `${markerLeft}px`;
                    pivotLine.appendChild(pivotMarker);
                }
            }
        }

        function updateStats() {
            document.getElementById('comparisons').textContent = comparisons;
            document.getElementById('swaps').textContent = swaps;
            document.getElementById('recursions').textContent = recursions;
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    const elapsed = (Date.now() - startTime) / 1000;
                    document.getElementById('time').textContent = elapsed.toFixed(1) + 's';
                }
            }, 100);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        async function sleep(ms) {
            const startTime = Date.now();
            while (Date.now() - startTime < ms) {
                if (isPaused) {
                    while (isPaused && isSorting) {
                        await new Promise(resolve => setTimeout(resolve, 50));
                    }
                }
                if (!isSorting) return;
                await new Promise(resolve => setTimeout(resolve, 50));
            }
        }

        async function animateSwap(idx1, idx2) {
            const bar1 = document.getElementById(`bar-${idx1}`);
            const bar2 = document.getElementById(`bar-${idx2}`);

            if (!bar1 || !bar2) return;

            const distance = (idx2 - idx1) * (bar1.offsetWidth + 4);

            bar1.style.transform = `translateX(${distance}px)`;
            bar2.style.transform = `translateX(${-distance}px)`;

            await new Promise(resolve => setTimeout(resolve, 300));

            bar1.style.transform = '';
            bar2.style.transform = '';
        }

        let sortedIndices = new Set();
        let currentDepth = 0;

        function updateInfo(pivot, range, action, depth) {
            document.getElementById('pivotElement').textContent = pivot;
            document.getElementById('partitionRange').textContent = range;
            document.getElementById('currentAction').textContent = action;
            document.getElementById('recursionDepth').textContent = depth;
        }

        async function partition(low, high) {
            if (!isSorting) return -1;

            const pivot = array[high];
            updateInfo(pivot, `[${low}...${high}]`, `Wähle Pivot ${pivot}`, currentDepth);
            renderArray({ pivot: high, partition: { start: low, end: high } });
            await sleep(parseInt(speedSlider.value));

            let i = low - 1;

            for (let j = low; j < high; j++) {
                if (!isSorting) return -1;

                comparisons++;
                updateStats();

                updateInfo(pivot, `[${low}...${high}]`, `Vergleiche ${array[j]} mit Pivot ${pivot}`, currentDepth);
                renderArray({
                    pivot: high,
                    comparing: [j],
                    partition: { start: low, end: high }
                });
                await sleep(parseInt(speedSlider.value));

                if (array[j] < pivot) {
                    i++;
                    if (i !== j) {
                        updateInfo(pivot, `[${low}...${high}]`, `Tausche ${array[i]} ↔ ${array[j]}`, currentDepth);

                        await animateSwap(i, j);

                        [array[i], array[j]] = [array[j], array[i]];
                        swaps++;
                        updateStats();

                        renderArray({
                            pivot: high,
                            comparing: [i, j],
                            partition: { start: low, end: high }
                        });
                    }
                }
            }

            updateInfo(pivot, `[${low}...${high}]`, `Setze Pivot an richtige Position`, currentDepth);

            await animateSwap(i + 1, high);

            [array[i + 1], array[high]] = [array[high], array[i + 1]];
            swaps++;
            updateStats();

            renderArray({ comparing: [i + 1, high], partition: { start: low, end: high } });

            sortedIndices.add(i + 1);
            return i + 1;
        }

        async function quickSort(low, high, depth = 0) {
            if (low < high) {
                if (!isSorting) return;

                currentDepth = depth;
                recursions++;
                updateStats();

                const pi = await partition(low, high);
                if (pi === -1) return;

                await quickSort(low, pi - 1, depth + 1);
                await quickSort(pi + 1, high, depth + 1);
            } else if (low === high) {
                sortedIndices.add(low);
            }
        }

        async function startSort() {
            if (isSorting) return;

            isSorting = true;
            isPaused = false;
            comparisons = 0;
            swaps = 0;
            recursions = 0;
            sortedIndices.clear();
            updateStats();
            startTimer();

            await quickSort(0, array.length - 1, 0);

            for (let i = 0; i < array.length; i++) {
                sortedIndices.add(i);
            }
            renderArray({ sorted: Array.from(sortedIndices) });
            updateInfo('-', '-', 'Sortierung abgeschlossen!', 0);

            isSorting = false;
            stopTimer();
        }

        function pauseSort() {
            isPaused = !isPaused;
        }

        function resetArray() {
            isSorting = false;
            isPaused = false;
            stopTimer();
            comparisons = 0;
            swaps = 0;
            recursions = 0;
            currentDepth = 0;
            sortedIndices.clear();
            document.getElementById('time').textContent = '0.0s';
            updateStats();
            updateInfo('-', '-', 'Warte auf Start...', 0);

            const size = parseInt(sizeSlider.value);
            array = generateArray(size);
            renderArray();
        }

        resetArray();
    </script>
</body>
</html>
